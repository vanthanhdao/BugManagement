
@model IEnumerable<QuanlyBug.Models.FILES>

@{
    USERS kh = (USERS)Session["TaiKhoan"];
    var project = ViewData["Project"] as QuanlyBug.Models.PROJECTS;
    var users = ViewData["User"] as IEnumerable<QuanlyBug.Models.UserModel>;
    var dataFuctions = ViewData["DataFuctions"] as IEnumerable<QuanlyBug.Models.ProjectList>;
    var dataBugs = ViewData["DataBugs"] as IEnumerable<QuanlyBug.Models.ProjectList>;
    var firstFuction = dataFuctions.FirstOrDefault();
    int? idFuction = firstFuction?.FunctionID;
    if (Session["idFuction"] != null)
    {
        idFuction = (int)Session["idFuction"];
    }
    var fucTions = dataFuctions.Where(f => f.FunctionID == idFuction).FirstOrDefault();

}

@using QuanlyBug.Models


@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutHome.cshtml";

}

<!-- CSS của Flatpickr -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<!-- JS của Flatpickr -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script src="~/Assets/dist/js/demo-theme.min.js?1684106062"></script>
<style>

    /* ======= Toast message ======== */

    #toastmess {
        position: fixed;
        top: 32px;
        right: 32px;
        z-index: 999999;
    }

    .toastmess {
        display: flex;
        align-items: center;
        background-color: #fff;
        border-radius: 2px;
        padding: 10px 0;
        min-width: 400px;
        max-width: 450px;
        border-left: 4px solid;
        box-shadow: 0 5px 8px rgba(0, 0, 0, 0.08);
        transition: all linear 0.3s;
    }

    @@keyframes slideInLeft {
        from {
            opacity: 0;
            transform: translateX(calc(100% + 32px));
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @@keyframes fadeOut {
        to {
            opacity: 0;
        }
    }

    .toast--success {
        border-color: #47d864;
    }

        .toast--success .toast__icon {
            color: #47d864;
        }

    .toast--info {
        border-color: #2f86eb;
    }

        .toast--info .toast__icon {
            color: #2f86eb;
        }

    .toast--warning {
        border-color: #ffc021;
    }

        .toast--warning .toast__icon {
            color: #ffc021;
        }

    .toast--error {
        border-color: #ff623d;
    }

        .toast--error .toast__icon {
            color: #ff623d;
        }

    .toastmess + .toastmess {
        margin-top: 24px;
    }

    .toast__icon {
        font-size: 24px;
    }

    .toast__icon,
    .toast__close {
        padding: 0 16px;
    }

    .toast__body {
        flex-grow: 1;
    }

    .toast__title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
    }

    .toast__msg {
        font-size: 14px;
        color: #888;
        margin-top: 6px;
        line-height: 1.5;
    }

    .toast__close {
        font-size: 20px;
        color: rgba(0, 0, 0, 0.3);
        cursor: pointer;
    }

    .scrollable {
        width: 100%;
        height: 100%;
        overflow-y: auto; /* or scroll */
        border: 1px solid #ccc;
    }

    body {
        overflow-y: hidden;
    }
</style>
<div class="page">

    <!-- Body -->
    <div class="page-wrapper">
        <!-- Page header -->
        <div class="page-header d-print-none">
            <div class="container-xl">
                <div class="row g-2 align-items-center">
                    <div class="col">
                        <!-- Page pre-title -->
                        <div class="page-pretitle">
                            <div class="page-title row-cols-md-auto">
                                <a href="~/Home/Project" class="ms-1" aria-label="Open website">
                                    Dự án /
                                </a>
                                <a>
                                    @project.Name
                                </a>
                            </div>
                        </div>
                    </div>
                    @if (kh.Status == "admin" || kh.Status == "Product Manager")
                    {
                        <div class="col-auto ms-auto d-print-none" style="margin-right:2%">
                            <a class="nav-link dropdown-toggle show" href="#navbar-help" data-bs-toggle="dropdown" data-bs-auto-close="outside" role="button" aria-expanded="true" style="">
                                <span class="nav-link-title" style="font-weight:bold">
                                    Thành viên trong dự án
                                </span>
                            </a>
                            <div class="dropdown-menu " data-bs-popper="static">
                                <div class=" d-flex justify-content-around">
                                    <h3>Email</h3>
                                    <h3>Vị trí</h3>
                                </div>
                                @foreach (var i in users)
                                {
                                    <a class="dropdown-item d-flex justify-content-around" href="#" role="button" aria-expanded="true">
                                        <span style="margin-right:5%">
                                            @i.Email@if (i.UserID == @kh.UserID)
                                            {<small style="font-size:10px; font-weight:bold">(Bạn)</small>}
                                        </span>
                                        @if (i.Status == "Product Manager")
                                        {
                                            <span>PM</span>}
                                        else
                                        {
                                            <span>@i.Status</span>}
                                    </a>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
        <!-- Page body -->
        <div class="page-body">
            <div class="container-xl">
                <div class="row row-cards">
                    <div class="col-lg-3">
                        <div class="card" style="background-color: #F6F8FB">
                            <div class="card-body">
                                <div class="overflow-auto" style="height:70vh">
                                    <div class="d-flex justify-content-between mb-3">
                                        <div class="me-3">
                                            <h3 class="lh-1" id="">Chức năng</h3>

                                        </div>
                                        @if (kh != null && kh.Status == "admin" || kh.Status == "Product Manager")
                                        {
                                            <div class="d-flex justify-content-between">
                                                <a href="#" data-bs-toggle="modal" data-bs-target="#modal-createfuction">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-circle-plus" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" /><path d="M9 12h6" /><path d="M12 9v6" /></svg>
                                                </a>
                                            </div>
                                        }

                                    </div>


                                    @foreach (var f in dataFuctions)
                                    {
                                        <div class="text-secondary mb-3">
                                            <a href="#" class="card card-link card-link-pop" onclick="loadSelectedProject(@f.FunctionID,@f.ProjectID)">
                                                <div class="card card-sm">
                                                    <div class="card-body">
                                                        <h3 class="card-title"> @f.Title</h3>
                                                        <div class="d-flex justify-content-between">
                                                            <div class="text-secondary">
                                                                @f.EmailUser
                                                            </div>
                                                            <div class="avatar-list avatar-list-stacked" style="margin-right:10px">
                                                                <span class="avatar avatar-xs rounded" style="background-image: url(../../Assets//images/logo.png)"></span>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card ">
                            <div class="card-body">
                                <div class="overflow-auto" style="height:70vh">
                                    <div class="d-flex justify-content-between mb-3">
                                        <h3 class="lh-1" id="">Danh sách bug</h3>
                                        @if (kh != null && (kh.Status == "admin" || kh.Status == "Product Manager" || kh.Status == "Tester") && firstFuction != null)
                                        {
                                            <div class="d-flex ">
                                                <a href="#" class="btn btn-outline-primary w-100" data-bs-toggle="modal" data-bs-target="#modal-createbug" role="button" aria-expanded="true">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-bug" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M9 9v-1a3 3 0 0 1 6 0v1" /><path d="M8 9h8a6 6 0 0 1 1 3v3a5 5 0 0 1 -10 0v-3a6 6 0 0 1 1 -3" /><path d="M3 13l4 0" /><path d="M17 13l4 0" /><path d="M12 20l0 -6" /><path d="M4 19l3.35 -2" /><path d="M20 19l-3.35 -2" /><path d="M4 7l3.75 2.4" /><path d="M20 7l-3.75 2.4" /></svg>
                                                    Tạo lỗi mới
                                                </a>
                                            </div>
                                        }
                                    </div>
                                    <div>
                                    </div>
                                    @foreach (var bug in dataBugs.Where(b => b.FunctionID == idFuction))
                                    {
                                        <div class="card card-sm" id="interfaceBug-@bug.BugID" style="margin-bottom:20px">
                                            <div class="card-status-top bg-yellow"></div>
                                            <div class="card-body">
                                                <div class="accordion-item">
                                                    <div class="accordion-header" id="heading-1">
                                                        <button class="accordion-button collapsed" onclick="toggleAccordion('titlebug-@bug.BugID','icon-chevron-down-@bug.BugID', '@bug.TitleBug')" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-@bug.BugID" aria-expanded="false">
                                                            <style>
                                                                .accordion-button::after {
                                                                    display: none;
                                                                }
                                                            </style>
                                                            <span id="titlebug-@bug.BugID">
                                                                @bug.TitleBug
                                                            </span>
                                                            <span id="icon-chevron-down-@bug.BugID" style="margin-left:auto">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M6 9l6 6l6 -6" /></svg>
                                                            </span>
                                                        </button>
                                                    </div>
                                                    <div id="collapse-@bug.BugID" class="accordion-collapse collapse" data-bs-parent="#accordion-example" style="">
                                                        <div class="accordion-body pt-0">

                                                            <h4>Tiêu đề:</h4>
                                                            <div class="text-secondary mb-3" id="EmailCreater">
                                                                <input type="text" class="form-control" name="NameProject" value=" @bug.TitleBug" disabled>
                                                            </div>

                                                            <h4>Dữ liệu kiểm tra:</h4>
                                                            <div class="text-secondary mb-3" id="EmailCreater">
                                                                <input type="text" class="form-control" name="NameProject" value="@bug.Input" disabled>
                                                            </div>

                                                            <h4>Các bước tạo lỗi:</h4>
                                                            <div class="text-secondary mb-3" id="EmailCreater">
                                                                <input type="text" class="form-control" name="NameProject" value="@bug.Reproduce" disabled>
                                                            </div>

                                                            <h4>Kết quả mong đợi:</h4>
                                                            <div class="text-secondary mb-3" id="EmailCreater">
                                                                <input type="text" class="form-control" name="NameProject" value="@bug.Expected" disabled>
                                                            </div>

                                                            <h4>Kết quả thực tế:</h4>
                                                            <div class="text-secondary mb-3" id="EmailCreater">
                                                                <input type="text" class="form-control" name="NameProject" value="@bug.Actual" disabled>
                                                            </div>

                                                            <h4 class="col-auto">Url:</h4>
                                                            <div class="col-auto text-secondary mb-3" id="EmailCreater">
                                                                <input type="text" class="form-control" name="NameProject" value="@bug.Url" disabled>
                                                            </div>

                                                            <div class="row">
                                                                <h4 class="col-auto">Mức độ nghiêm trọng:</h4>
                                                                <div class="col-auto text-secondary mb-3" id="EmailCreater">
                                                                    <span class="nav-link-title" id="spanStatus">
                                                                        @bug.Severity
                                                                    </span>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <h4 class="col-auto">Mức độ ưu tiên:</h4>
                                                                <div class="col-auto text-secondary mb-3" id="EmailCreater">
                                                                    <span class="nav-link-title" id="spanStatus">
                                                                        @bug.Priority
                                                                    </span>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <h4 class="col-auto">Môi trường:</h4>
                                                                <div class="col-auto text-secondary mb-3" id="EmailCreater">
                                                                    <span class="nav-link-title" id="spanStatus">
                                                                        @bug.Env
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            @if (kh.Status == "admin" || kh.Status == "Product Manager" || kh.Status == "Tester")
                                                            {
                                                                if (bug.StatusBug == "Fixed" || bug.StatusBug == "Retest")
                                                                {
                                                                    <div class="row">
                                                                        <h4 class="col-auto">Trạng thái bug:</h4>

                                                                        <div class="col-auto text-secondary mb-3" id="EmailCreater">
                                                                            <select id="severitySelect" class="form-select" name="severity" onchange="updateStatus(@project.ProjectID,@bug.BugID)">
                                                                                <option hidden>@bug.StatusBug</option>
                                                                                <option value="Retest">Retest</option>
                                                                                <option value="Reopened">Reopened</option>
                                                                                <option value="Verified">Verified</option>
                                                                            </select>
                                                                        </div>
                                                                        <div class="col-auto text-secondary mb-3" style="display: flex; justify-content: center; align-items: center;">
                                                                            <a id="statusLink" href="#">
                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-device-floppy"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2" /><path d="M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M14 4l0 4l-6 0l0 -4" /></svg>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                }
                                                                else
                                                                {

                                                                    <div class="row">
                                                                        <h4 class="col-auto">Trạng thái bug:</h4>
                                                                        <div class="col-auto text-secondary mb-3" id="EmailCreater">
                                                                            <span class="nav-link-title" id="spanStatus">
                                                                                @bug.StatusBug
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                }
                                                            }
                                                            else
                                                            {
                                                                if (bug.StatusBug == "Verified")
                                                                {
                                                                    <div class="row">
                                                                        <h4 class="col-auto">Trạng thái bug:</h4>
                                                                        <div class="col-auto text-secondary mb-3" id="EmailCreater">
                                                                            <span class="nav-link-title" id="spanStatus">
                                                                                @bug.StatusBug
                                                                            </span>
                                                                        </div>
                                                                    </div>
                                                                }
                                                                else if (bug.StatusBug == "Reopened")
                                                                {
                                                                    <div class="row">
                                                                        <h4 class="col-auto">Trạng thái bug:</h4>

                                                                        <div class="col-auto text-secondary mb-3" id="EmailCreater">
                                                                            <select id="severitySelect" class="form-select" name="severity" onchange="updateStatus(@project.ProjectID,@bug.BugID)">
                                                                                <option hidden>@bug.StatusBug</option>
                                                                                <option value="Open">Open</option>
                                                                            </select>
                                                                        </div>
                                                                        <div class="col-auto text-secondary mb-3" style="display: flex; justify-content: center; align-items: center;">
                                                                            <a id="statusLink" href="#">
                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-device-floppy"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2" /><path d="M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M14 4l0 4l-6 0l0 -4" /></svg>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                }
                                                                else
                                                                {
                                                                    <div class="row">
                                                                        <h4 class="col-auto">Trạng thái bug:</h4>

                                                                        <div class="col-auto text-secondary mb-3" id="EmailCreater">
                                                                            <select id="severitySelect" class="form-select" name="severity" onchange="updateStatus(@project.ProjectID,@bug.BugID)">
                                                                                <option hidden>@bug.StatusBug</option>
                                                                                <option value="Open">Open</option>
                                                                                <option value="Duplicate">Duplicate</option>
                                                                                <option value="Rejected">Rejected</option>
                                                                                <option value="Not a bug">Not a bug</option>
                                                                                <option value="Fixed">Fixed</option>
                                                                            </select>
                                                                        </div>
                                                                        <div class="col-auto text-secondary mb-3" style="display: flex; justify-content: center; align-items: center;">
                                                                            <a id="statusLink" href="#">
                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-device-floppy"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2" /><path d="M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M14 4l0 4l-6 0l0 -4" /></svg>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                }
                                                            }
                                                            <div class="row">
                                                                <h4 class="col-auto">Thời hạn:</h4>
                                                                <div class="col-auto text-secondary mb-3" id="Deadline">
                                                                    <span class="nav-link-title" id="deadline">
                                                                        @bug.deadline
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <h4 class="col-auto">Người sữa lỗi:</h4>
                                                                <div class="col-auto text-secondary mb-3" id="Deadline">
                                                                    <span class="nav-link-title" id="deadline">
                                                                        @bug.nameUserChose
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <h4>File đính kèm:</h4>
                                                            <div class="text-secondary mb-3" id="EmailCreater">
                                                                @foreach (var file in Model.Where(f => f.BugID == bug.BugID))
                                                                {
                                                                    if (file.FileType == "image/png" || file.FileType == "image/jpeg")
                                                                    {
                                                                        <img src="data:@file.FileType;base64,@Convert.ToBase64String(file.FileData)" alt="Description of the image">
                                                                    }
                                                                    else
                                                                    {
                                                                        <label for="fileInput">@file.FileName</label>
                                                                        <a href="data:application/octet-stream;base64,@Convert.ToBase64String(file.FileData)" download="@file.FileName">
                                                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-file-download" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" /><path d="M12 17v-6" /><path d="M9.5 14.5l2.5 2.5l2.5 -2.5" /></svg>
                                                                        </a>

                                                                    }

                                                                }
                                                            </div>

                                                            <h4>Thông tin thêm:</h4>
                                                            <div class="text-secondary mb-3" id="EmailCreater">
                                                                <input type="text" class="form-control" name="NameProject" value="@bug.Description" disabled>
                                                            </div>

                                                            @if (bug.StatusBug == "New" || bug.StatusBug == "Dimiss" || bug.StatusBug == "Duplicate" || bug.StatusBug == "Rejected" || bug.StatusBug == "Not a bug" || bug.StatusBug == "Verified")
                                                            {
                                                                <div class="card">
                                                                    <div class="card-header">
                                                                        <ul class="nav nav-tabs card-header-tabs" data-bs-toggle="tabs" role="tablist">
                                                                            @if (kh.Status == "Product Manager" || kh.Status == "admin" || kh.Status == "Tester")
                                                                            {
                                                                                if ((kh.Status == "Product Manager" || kh.Status == "admin") && (bug.StatusBug == "New" || bug.StatusBug == "Verified"))
                                                                                {
                                                                                    <li class="nav-item" role="presentation">
                                                                                        <a href="#tabs-profile-4" class="nav-link active" data-bs-toggle="tab" aria-selected="true" role="tab">Duyệt</a>
                                                                                    </li>
                                                                                }
                                                                                if (bug.StatusBug == "New" || bug.StatusBug == "Dimiss" || bug.StatusBug == "Duplicate" || bug.StatusBug == "Rejected" || bug.StatusBug == "Not a bug")
                                                                                {
                                                                                    <li class="nav-item dropdown">
                                                                                        <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Cài đặt</a>
                                                                                        <div class="dropdown-menu" style="">
                                                                                            <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#modal-editbug-@bug.BugID" role="button" aria-expanded="true">
                                                                                                Cập nhật
                                                                                            </a>

                                                                                            <a class="dropdown-item text-pink" href="#" data-bs-toggle="modal" data-bs-target="#modal-deleteproject-@bug.BugID" role="button" aria-expanded="true">
                                                                                                Xóa
                                                                                            </a>

                                                                                        </div>
                                                                                    </li>
                                                                                }
                                                                            }
                                                                        </ul>
                                                                    </div>
                                                                    <div class="card-body">
                                                                        <div class="tab-content">
                                                                            @if (kh.Status == "Product Manager" || kh.Status == "admin")
                                                                            {
                                                                                <div class="tab-pane active show" id="tabs-profile-4" role="tabpanel">

                                                                                    @if (bug.StatusBug == "New")
                                                                                    {
                                                                                        <div class="mb-3">
                                                                                            <label class="form-label">Email</label>
                                                                                            <select class="form-select" name="Email" id="emailSelect" onchange="updateUrl(@project.ProjectID,@bug.BugID)">
                                                                                                @if (users != null)
                                                                                                {
                                                                                                    <option value="">-- Chọn email --</option>
                                                                                                    foreach (var i in users.Where(x=>x.Status == "Dev"))
                                                                                                    {
                                                                                                        <option value="@i.Email">@i.Email</option>
                                                                                                    }
                                                                                                }
                                                                                            </select>

                                                                                        </div>
                                                                                        <div class="row g-2">
                                                                                            <div class="col-4 col-sm-4 col-md-2 col-xl py-3">
                                                                                                <a href="@Url.Action("ChangeStatusBug", "BUGs", new { idPro = project.ProjectID, idBug = bug.BugID, status = "Dimiss" })" class="btn btn-danger w-100">
                                                                                                    Từ chối
                                                                                                </a>
                                                                                            </div>
                                                                                            <div class="col-4 col-sm-4 col-md-2 col-xl py-3">
                                                                                            </div>
                                                                                            <div class="col-4 col-sm-4 col-md-2 col-xl py-3">
                                                                                                <a id="changeStatusLink" href="" class="btn btn-info w-100">
                                                                                                    Đồng ý
                                                                                                </a>
                                                                                            </div>

                                                                                        </div>
                                                                                    }
                                                                                    else if(bug.StatusBug == "Verified")
                                                                                    {
                                                                                        <div class="row g-2">
                                                                                            <div class="col-4 col-sm-4 col-md-2 col-xl py-3">
                                                                                                <a href="@Url.Action("ChangeStatusBug", "BUGs", new { idPro = project.ProjectID, idBug = bug.BugID, status = "New" })" class="btn btn-danger w-100">
                                                                                                    Từ chối
                                                                                                </a>
                                                                                            </div>
                                                                                            <div class="col-4 col-sm-4 col-md-2 col-xl py-3">
                                                                                            </div>
                                                                                            <div class="col-4 col-sm-4 col-md-2 col-xl py-3">
                                                                                                <a href="#" onclick="approveBug(@bug.FunctionID,@project.ProjectID,@bug.BugID)" class="btn btn-info w-100">
                                                                                                    Đồng ý
                                                                                                </a>
                                                                                            </div>

                                                                                        </div>
                                                                                    }
                                                                                </div>
                                                                            }
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            }



                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        using (Html.BeginForm("EditBug", "BUGs", new { idPro = project.ProjectID, idBug = bug.BugID, idFuc = bug.FunctionID }, FormMethod.Post, new { @class = "editBugForm", @novalidate = "novalidate", enctype = "multipart/form-data" }))
                                        {
                                            <div class="modal modal-blur fade" id="modal-editbug-@bug.BugID" tabindex="-1" aria-modal="true" role="dialog">
                                                <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                                                    <div class="modal-content">

                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Cập nhật lỗi </h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>

                                                        <div class="modal-body overflow-auto" style="height:70vh">
                                                            <div class="mb-3">
                                                                <label class="form-label">Tiêu đề</label>
                                                                <input type="text" class="form-control" name="title" id="TitleBug" placeholder="Nhập tiêu đề" value="@bug.TitleBug" required>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-lg-6">
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Dữ liệu kiểm tra</label>
                                                                        <textarea class="form-control" name="input" rows="3" required>@bug.Input</textarea>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-6">
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Các bước tái tạo lỗi</label>
                                                                        <textarea class="form-control" name="stepsToReproduce" rows="3" required>@bug.Reproduce</textarea>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-lg-6">
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Kết quả mong đợi</label>
                                                                        <input type="text" class="form-control" name="expected" value="@bug.Expected" required>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-6">
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Kết quả thực tế</label>
                                                                        <input type="text" class="form-control" name="actual" value="@bug.Actual" required>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-lg-6">
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Url</label>
                                                                        <input type="text" class="form-control" name="url" value="@bug.Url" required>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-3">
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Mức độ nghiêm trọng</label>
                                                                        <select class="form-select" name="severity">
                                                                            <option hidden>@bug.Severity</option>
                                                                            <option value="Nghiêm trọng">Nghiêm trọng</option>
                                                                            <option value="Cao">Cao</option>
                                                                            <option value="Trung bình">Trung bình</option>
                                                                            <option value="Thấp">Thấp</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-3">
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Mức độ ưu tiên</label>
                                                                        <select class="form-select" name="priority" value="@bug.Priority">
                                                                            <option hidden>@bug.Priority</option>
                                                                            <option value="Cao">Cao</option>
                                                                            <option value="Trung bình">Trung bình</option>
                                                                            <option value="Thấp">Thấp</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-lg-6">
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Môi trường</label>
                                                                        <input type="text" class="form-control" name="enviroment" value="@bug.Env" required>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-6">
                                                                    <div class="mb-3">
                                                                        <label class="form-label">File đính kèm</label>
                                                                        @foreach (var file in Model.Where(f => f.BugID == bug.BugID))
                                                                        {
                                                                            <label for="fileInput">@file.FileName</label>
                                                                        }
                                                                        <input type="file" class="form-control" name="files" multiple required>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-6">
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Trạng thái</label>
                                                                        <select class="form-select" name="StatusBug">
                                                                            <option value="@bug.StatusBug">@bug.StatusBug</option>
                                                                            @*<option value="Reopen">Reopen</option>*@
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-6">
                                                                    <div class="mb-3">
                                                                        <label class="form-label" for="datetimepicker">Chọn ngày và giờ:</label>
                                                                        <div class="input-group date" id="datetimepicker" data-target-input="nearest">
                                                                            <input class="form-control" name="deadline" type="text" value="@bug.deadline" id="datetimepicker" placeholder="Chọn ngày và giờ">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-12">
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Thông tin thêm</label>
                                                                        <textarea class="form-control" rows="3" name="description" required>@bug.Description</textarea>
                                                                    </div>
                                                                </div>

                                                            </div>

                                                        </div>

                                                        <div class="modal-footer">
                                                            <button type="button" class="btn me-auto" data-bs-dismiss="modal">Hủy</button>
                                                            <button type="submit" class="btn btn-primary">Gửi</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }

                                        using (Html.BeginForm("DeleteBug", "BUGs", new { idPro = project.ProjectID, idBug = bug.BugID, idFuc = bug.FunctionID }, FormMethod.Post, new { @class = "deleteBugForm", @novalidate = "novalidate" }))
                                        {
                                            <div class="modal modal-blur fade" id="modal-deleteproject-@bug.BugID" tabindex="-1" role="dialog" aria-hidden="true">
                                                <div class="modal-dialog modal-lg" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Xóa bug</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="mb-3">
                                                                <label class="form-label">Tiêu đề</label>
                                                                <input type="text" class="form-control" name="NameBug" value="@bug.TitleBug" disabled>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label class="form-label" id="lableComfirm">Xác nhận xóa</label>
                                                                <input type="text" class="form-control" name="NewNameBug" oninput="updateValue(this,'@bug.TitleBug')" id="inputConfirm" required>
                                                            </div>

                                                        </div>

                                                        <div class="modal-footer">
                                                            <a href="#" class="btn btn-link link-secondary" data-bs-dismiss="modal">
                                                                Hủy
                                                            </a>
                                                            <button type="submit" class="btn btn-primary ms-auto">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/plus -->
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M12 5l0 14" /><path d="M5 12l14 0" /></svg>
                                                                Gửi
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }

                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div style="display:contents">
                            <div class="card-body">

                                <div id="toastmess"></div>

                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body">

                                <div class="overflow-auto" style="height:70vh">
                                    @if (fucTions != null)
                                    {
                                        if (kh.Status == "admin" || kh.Status == "Product Manager")
                                        {
                                            <a class="nav-link dropdown-toggle show" href="#navbar-help" data-bs-toggle="dropdown" data-bs-auto-close="outside" role="button" aria-expanded="true" style="">
                                                <span class="nav-link-title" style="font-weight:bold">
                                                    Cài đặt
                                                </span>
                                            </a>
                                            <div class="dropdown-menu " data-bs-popper="static">
                                                <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#modal-editfuction" role="button" aria-expanded="true">
                                                    Cập nhật
                                                </a>
                                                <a class="dropdown-item text-pink" data-bs-toggle="modal" data-bs-target="#modal-deletefunc" role="button" aria-expanded="true">
                                                    Xóa
                                                </a>
                                            </div>
                                        }

                                        <div class="d-flex justify-content-center align-items-center mb-3" style="margin-top:20px">
                                            <h1 class="me-3">
                                                <!-- Download SVG icon from http://tabler-icons.io/i/scale -->
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-md" width="14" height="14" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 20l10 0"></path><path d="M6 6l6 -1l6 1"></path><path d="M12 3l0 17"></path><path d="M9 12l-3 -6l-3 6a3 3 0 0 0 6 0"></path><path d="M21 12l-3 -6l-3 6a3 3 0 0 0 6 0"></path></svg>
                                            </h1>
                                            <div id="Title">

                                                <h1 class="lh-1" id="projectTitle">@fucTions.Title</h1>

                                            </div>
                                        </div>
                                        <div class="text-secondary mb-3" id="Description" style="text-align:center">

                                            @fucTions.DescriptionFunc
                                        </div>

                                        <h4>Người tạo chức năng:</h4>
                                        <div class="text-secondary mb-3" id="EmailCreater">

                                            @fucTions.EmailCreater

                                        </div>
                                        <h4>Ngày tạo:</h4>
                                        <div class="text-secondary mb-3" id="DateCreated">

                                            @fucTions.DateCreated

                                        </div>
                                        <h4>Người được ủy nhiệm:</h4>
                                        <div class="text-secondary mb-3" id="EmailUser">

                                            @fucTions.EmailUser

                                        </div>
                                        <h4>Trạng thái:</h4>
                                        <div class="text-secondary mb-3">
                                            @*@if (kh != null && kh.Status == "admin" || kh.Status == "Product Manager")
                                                {
                                                    <a class="nav-link dropdown-toggle show" href="#navbar-help" data-bs-toggle="dropdown" data-bs-auto-close="outside" role="button" aria-expanded="true">
                                                        <span class="nav-link-title" id="Status">
                                                            @fucTions.Status
                                                        </span>
                                                    </a>
                                                    <div class="dropdown-menu " data-bs-popper="static">
                                                        <a class="dropdown-item" href="https://tabler.io/docs" target="_blank" rel="noopener">
                                                            ToDo
                                                        </a>
                                                        <a class="dropdown-item" href="./changelog.html">
                                                            InProgress
                                                        </a>
                                                        <a class="dropdown-item" href="https://github.com/tabler/tabler" target="_blank" rel="noopener">
                                                            InterView
                                                        </a>
                                                    </div>
                                                }
                                                else
                                                {*@
                                            <span class="nav-link-title" id="spanStatus">
                                                @fucTions.Status
                                            </span>
                                            @*}*@
                                        </div>
                                        <div class="card-footer">
                                            This is not legal advice.
                                            <a href="#">Learn more about repository licenses.</a>
                                        </div>
                                        <div class="data-idfunct" data-idfunct=@fucTions.Title></div>

                                        using (Html.BeginForm("EditFunction", "BUGs", new { @id = fucTions.FunctionID, @EmailUserT = fucTions.EmailUser, @IdProject = project.ProjectID }, FormMethod.Post, new { @class = "editfunction", @novalidate = "novalidate" }))
                                        {
                                            <div class="modal modal-blur fade" id="modal-editfuction" tabindex="-1" role="dialog" aria-hidden="true">
                                                <div class="modal-dialog modal-lg" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Sữa chức năng</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="mb-3">
                                                                <label class="form-label">Tên chức năng</label>
                                                                <input type="text" class="form-control" name="NameFunction" id="NameFunctions" placeholder="Tên chức năng" value="@fucTions.Title" required>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label class="form-label">Mô tả</label>
                                                                <textarea class="form-control" name="DescriptionFunction" id="DescriptionFunctions" rows="3" placeholder="Mô tả dự án của bạn" required>@fucTions.DescriptionFunc</textarea>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-lg-8">
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Email</label>
                                                                        <select class="form-select" name="EmailFunction" id="EmailFunction">
                                                                            @if (users != null)
                                                                            {
                                                                                foreach (var i in users.Where(x => x.Status == "Tester"))
                                                                                {
                                                                                    <option value="@i.Email">@i.Email</option>
                                                                                }
                                                                            }

                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="modal-footer">
                                                                <a href="#" class="btn btn-link link-secondary" data-bs-dismiss="modal">
                                                                    Hủy
                                                                </a>
                                                                <button type="submit" class="btn btn-primary ms-auto">
                                                                    <!-- Download SVG icon from http://tabler-icons.io/i/plus -->
                                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M12 5l0 14" /><path d="M5 12l14 0" /></svg>
                                                                    Gửi
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                        using (Html.BeginForm("DeleteFunc", "BUGs", new { id = project.ProjectID, idfunc = fucTions.FunctionID }, FormMethod.Post, new { @class = "deleteBugForm", @novalidate = "novalidate" }))
                                        {
                                            <div class="modal modal-blur fade" id="modal-deletefunc" tabindex="-1" role="dialog" aria-hidden="true">
                                                <div class="modal-dialog modal-lg" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Xóa chức năng</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="mb-3">
                                                                <label class="form-label">Tiêu đề</label>
                                                                <input type="text" class="form-control" name="NameBug" value="@fucTions.Title" disabled>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label class="form-label" id="lableComfirm">Xác nhận xóa</label>
                                                                <input type="text" class="form-control" name="NewNameBug" oninput="updateValue(this,'@fucTions.Title')" id="inputConfirm" required>
                                                            </div>

                                                        </div>

                                                        <div class="modal-footer">
                                                            <a href="#" class="btn btn-link link-secondary" data-bs-dismiss="modal">
                                                                Hủy
                                                            </a>
                                                            <button type="submit" class="btn btn-primary ms-auto">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/plus -->
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M12 5l0 14" /><path d="M5 12l14 0" /></svg>
                                                                Gửi
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }


                                    }
                                    else
                                    {
                                        <div class="empty">
                                            <img src="~/Assets/images/noresult1.png" alt="">
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

@using (Html.BeginForm("CreateFunction", "BUGs", new { @id = project.ProjectID }, FormMethod.Post, new { @class = "createFunctionForm", @novalidate = "novalidate" }))
{
    <div class="modal modal-blur fade" id="modal-createfuction" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tạo mới một chức năng</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Tên chức năng</label>
                        <input type="text" class="form-control" name="NameFunction" id="NameFunction" placeholder="Tên chức năng" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Mô tả</label>
                        <textarea class="form-control" name="DescriptionFunction" id="DescriptionFunction" rows="3" placeholder="Mô tả dự án của bạn" required></textarea>
                    </div>
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="mb-3">
                                <label class="form-label">Email</label>
                                <select class="form-select" name="EmailFunction" id="EmailFunction">
                                    @if (users != null)
                                    {
                                        foreach (var i in users.Where(x => x.Status == "Tester"))
                                        {
                                            <option value="@i.Email">@i.Email</option>
                                        }
                                    }

                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <a href="#" class="btn btn-link link-secondary" data-bs-dismiss="modal">
                            Hủy
                        </a>
                        <button type="submit" class="btn btn-primary ms-auto">
                            <!-- Download SVG icon from http://tabler-icons.io/i/plus -->
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M12 5l0 14" /><path d="M5 12l14 0" /></svg>
                            Gửi
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
}


@using (Html.BeginForm("CreateBug", "BUGs", new { @id = project.ProjectID, @idFuction = idFuction }, FormMethod.Post, new { @class = "createBugForm", @novalidate = "novalidate", enctype = "multipart/form-data" }))
{
    <div class="modal modal-blur fade" id="modal-createbug" tabindex="-1" aria-modal="true" role="dialog">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title">
                        Tạo Bug
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body overflow-auto" style="height:70vh">
                    <div class="mb-3">
                        <label class="form-label">Tiêu đề</label>
                        <input type="text" class="form-control" name="title" id="TitleBug" placeholder="Nhập tiêu đề" required>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Dữ liệu kiểm tra</label>
                                <textarea class="form-control" name="input" rows="3" required></textarea>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Các bước tái tạo lỗi</label>
                                <textarea class="form-control" name="stepsToReproduce" rows="3" required></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Kết quả mong đợi</label>
                                <input type="text" class="form-control" name="expected" required>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Kết quả thực tế</label>
                                <input type="text" class="form-control" name="actual" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Url</label>
                                <input type="text" class="form-control" name="url" required>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="mb-3">
                                <label class="form-label">Mức độ nghiêm trọng</label>
                                <select class="form-select" name="severity">
                                    <option value="Nghiêm trọng">Nghiêm trọng</option>
                                    <option value="Cao">Cao</option>
                                    <option value="Trung bình">Trung bình</option>
                                    <option value="Thấp">Thấp</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="mb-3">
                                <label class="form-label">Mức độ ưu tiên</label>
                                <select class="form-select" name="priority">
                                    <option value="Cao" selected="">Cao</option>
                                    <option value="Trung bình">Trung bình</option>
                                    <option value="Thấp">Thấp</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">Môi trường</label>
                                <input type="text" class="form-control" name="enviroment" required>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <label class="form-label">File đính kèm</label>
                                <input type="file" class="form-control" name="files" multiple required>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="mb-3">
                                <div class="form-group">
                                    <label class="form-label" for="datetimepicker">Chọn ngày và giờ:</label>
                                    <div class="input-group date" id="datetimepicker" data-target-input="nearest">
                                        <input name="deadline" type="text" id="datetimepicker" placeholder="Chọn ngày và giờ">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div>
                                <label class="form-label">Thông tin thêm</label>
                                <textarea class="form-control" rows="3" name="description" required></textarea>
                            </div>
                        </div>
                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn me-auto" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary">Gửi</button>
                </div>
            </div>
        </div>
    </div>
}

<script>

    (() => {
        'use strict'
        /* const forms = document.querySelectorAll('.deleteForm');*/
        const formCreatFunction = document.querySelector('.createFunctionForm');
        const formCreatBug = document.querySelector('.createBugForm');
        const formEditFunction = document.querySelector(".editfunction");

        formEditFunction.addEventListener('submit', function (event) {
            event.preventDefault();
            event.stopPropagation();
            var nameFunction = document.getElementById("NameFunctions");
            var descriptionFunction = document.getElementById("DescriptionFunctions");
            var namefunction = document.querySelector("[data-idfunct]").getAttribute("data-idfunct");
            $.ajax({
                url: '/BUGs/GetDataFuncion',
                type: 'GET',
                success: function (data) {
                    const checkName = data.some(element => element.Title === namefunction);
                    const checkNameAll = data.some(element => element.Title === nameFunction.value && element.Title != namefunction);
                    console.log(checkName)
                    if (checkName) {
                        nameFunction.setCustomValidity('');
                    } else {
                        nameFunction.setCustomValidity("This field is invalid");
                    }
                    if (!checkNameAll) {
                        nameFunction.setCustomValidity('');

                    } else {
                        nameFunction.setCustomValidity("This field is invalid");
                    }

                    if (descriptionFunction != null) {
                        descriptionFunction.setCustomValidity('');
                    } else {
                        descriptionFunction.setCustomValidity("This field is invalid");
                    }

                    if (formEditFunction.checkValidity()) {
                        formEditFunction.submit();
                    }
                    formEditFunction.classList.add('was-validated');
                },
                error: function (errorThrown) {
                    console.log('Error:', errorThrown);
                }
            });
        }, false);

        formCreatFunction.addEventListener('submit', function (event) {
            event.preventDefault();
            event.stopPropagation();

            var nameFunction = document.getElementById("NameFunction");
            var descriptionFunction = document.getElementById("DescriptionFunction");

            // Perform AJAX call
            $.ajax({
                url: '/BUGs/GetDataFuncion',
                type: 'GET',
                success: function (data) {
                    console.log(data)
                    const checkName = data.some(element => element.Title === nameFunction.value);
                    const checkDescription = data.some(element => element.Description === descriptionFunction.value);

                    if (!checkName) {
                        nameFunction.setCustomValidity('');
                    } else {
                        nameFunction.setCustomValidity("This field is invalid");
                    }
                    if (descriptionFunction != null) {
                        descriptionFunction.setCustomValidity('');
                    } else {
                        descriptionFunction.setCustomValidity("This field is invalid");
                    }

                    if (formCreatFunction.checkValidity()) {
                        formCreatFunction.submit();
                    }
                    formCreatFunction.classList.add('was-validated');
                },
                error: function (errorThrown) {
                    console.log('Error:', errorThrown);
                }
            });
        }, false);

        formCreatBug.addEventListener('submit', function (event) {
            event.preventDefault();
            event.stopPropagation();

            var titleBug = document.getElementById("TitleBug");

            // Perform AJAX call
            $.ajax({
                url: '/BUGs/GetDataBug',
                type: 'GET',
                success: function (data) {
                    console.log(data)
                    const checkName = data.some(element => element.Title === titleBug.value);
                    if (!checkName) {
                        titleBug.setCustomValidity('');
                    } else {
                        titleBug.setCustomValidity("This field is invalid");
                    }

                    if (formCreatBug.checkValidity()) {
                        formCreatBug.submit();
                    }
                    formCreatBug.classList.add('was-validated');
                },
                error: function (errorThrown) {
                    console.log('Error:', errorThrown);
                }
            });
        }, false);

    })();

    function loadSelectedProject(FunctionID, ProjectID) {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/BUGs/UpdateDataBug?idfuc=' + FunctionID + '&idPro=' + ProjectID, true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    window.location.href = response.redirectToAction;
                } else {
                    console.error('Error:', xhr.status);
                }
            }
        };
        xhr.send();

    }

    function approveBug(FunctionID, ProjectID, BugID) {
        console.log(FunctionID, ProjectID, BugID)
        var xhr = new XMLHttpRequest();
        xhr.open('POST', "/BUGs/DeleteBug?idPro=" + ProjectID + "&idBug=" + BugID + "&idFuc=" + FunctionID, true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    window.location.href = response.redirectToAction;
                } else {
                    console.error('Error:', xhr.status);
                }
            }
        };
        xhr.send();

    }

    function updateUrl(idPro, idBug) {
        var selectedEmail = document.getElementById("emailSelect").value;
        var url = '/BUGs/ChangeStatusBug?idPro=' + idPro + '&idBug=' + idBug + '&email=' + selectedEmail + '&status=Assigned';
        console.log(url)
        document.getElementById("changeStatusLink").setAttribute("href", url);
    }

    function updateStatus(idPro, idBug) {
        var selectedStatus = document.getElementById("severitySelect").value;
        var url = '/BUGs/ChangeStatusBug?idPro=' + idPro + '&idBug=' + idBug + '&status=' + selectedStatus;
        console.log(url)
        document.getElementById("statusLink").setAttribute("href", url);
    }

    function toggleAccordion(id, icon, idbug) {
        var accordionBody = document.getElementById(id);
        var icon = document.getElementById(icon);
        if (accordionBody.textContent !== "") {
            accordionBody.textContent = "";
            icon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-up" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 15l6 -6l6 6" /></svg>';
        } else {
            accordionBody.textContent = idbug;
            icon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-down" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg>';
        }
    }

    function updateValue(inputElement, name) {
        var value = inputElement.value;
        if (value === name) {
            inputElement.setCustomValidity("");
            inputElement.style.borderColor = "";
        } else {
            inputElement.setCustomValidity("This field is invalid");
            inputElement.style.borderColor = "red";
        }
    }




</script>
<script>

    (() => {
        'use strict';

        const form = document.querySelector('.author');
        const formAddMember = document.querySelector('.addmember');
        const formCreateBug = document.querySelector('.createbug');
        var email = document.getElementById('email');

        form.addEventListener('submit', event => {
            event.preventDefault();
            event.stopPropagation();

            $.ajax({
                url: '/Home/GetData',
                type: 'GET',
                success: function (data) {
                    console.log('Data:', data);
                    var projects = data;
                    var inputEmailAuthor = document.getElementById("email");

                    // Mỗi lần submit, reset custom validity
                    inputEmailAuthor.setCustomValidity('');

                    projects.forEach(function (project) {
                        if (project.Email == email.value && project.Status != null) {
                            inputEmailAuthor.setCustomValidity("This field is invalid");
                        }
                    });

                    if (form.checkValidity()) {
                        const dataToSend = {
                            email: document.getElementById('email').value,
                            role: document.getElementById('role').value,
                        };

                        $.ajax({
                            type: "POST",
                            url: "/Home/Authorization",
                            data: dataToSend,
                            success: function (response) {
                                // Xử lý kết quả từ controller (nếu cần)
                                console.log(response);
                            },
                            error: function (error) {
                                // Xử lý lỗi nếu có
                                console.error(error);
                            }
                        });

                        toast({
                            title: "Thành công!",
                            message: `Chúng tôi đã gửi tới email ${dataToSend.email} để xác nhận.`,
                            type: "success",
                            duration: 5000
                        });
                    } else {
                        toast({
                            title: "Thất bại!",
                            message: `Email ${email.value} đã được xác nhận.`,
                            type: "error",
                            duration: 5000
                        });
                    }

                },
                error: function (error) {
                    console.log('Error:', error);
                }
            });

            form.classList.add('was-validated');
        }, false);

        formAddMember.addEventListener('submit', event => {

            event.preventDefault();
            event.stopPropagation();
            var inputNameOrEmail = document.getElementById("nameOrEmail");
            var inputNameProject = document.getElementById("nameProject");

            $.ajax({
                url: '/Home/GetDataProjectList',
                type: 'GET',
                success: function (data) {
                    const checkNameOrEmail = inputNameOrEmail.value != "" ? data.some(element => element.Email === inputNameOrEmail.value) : null;
                    const checkProjectMember = inputNameOrEmail.value != "" ? data.some(element => element.Email === inputNameOrEmail.value && element.Name === inputNameProject.value) : null;
                    console.log(checkNameOrEmail, checkProjectMember)
                    /* inputNameOrEmail.setCustomValidity('');*/
                    if (checkNameOrEmail) {
                        inputNameOrEmail.setCustomValidity('');
                    } else {
                        inputNameOrEmail.setCustomValidity("This field is invalid");
                    }

                    if (!checkProjectMember) {
                        inputNameOrEmail.setCustomValidity('');
                    } else {
                        inputNameOrEmail.setCustomValidity("This field is invalid");
                    }

                    if (formAddMember.checkValidity()) {
                        const dataToSend = {
                            email: inputNameOrEmail.value,
                            nameProject: inputNameProject.value,
                        };

                        $.ajax({
                            type: "POST",
                            url: "/Home/AuthorizationAddMember",
                            data: dataToSend,
                            success: function (response) {
                                // Xử lý kết quả từ controller (nếu cần)
                                console.log(response);
                            },
                            error: function (error) {
                                // Xử lý lỗi nếu có
                                console.error(error);
                            }
                        });

                        toast({
                            title: "Thành công!",
                            message: `Chúng tôi đã gửi tới email ${inputNameOrEmail.value} để xác nhận.`,
                            type: "success",
                            duration: 5000
                        });

                        setTimeout(function () {
                            // Load lại trang sau khi đã chờ 5 giây
                            location.reload();
                        }, 2000);
                    } else {
                        if (checkNameOrEmail == false) {
                            toast({
                                title: "Thất bại!",
                                message: `Email ${inputNameOrEmail.value} chưa được cấp quyền sử dụng.`,
                                type: "error",
                                duration: 5000
                            });
                        } else if (checkProjectMember == true) {
                            toast({
                                title: "Thất bại!",
                                message: `Email ${inputNameOrEmail.value} đã tham gia dự án.`,
                                type: "error",
                                duration: 5000
                            });
                        } else {
                            toast({
                                title: "Thất bại!",
                                message: `Email không được để trống.`,
                                type: "error",
                                duration: 5000
                            });
                        }
                    }

                },
                error: function (error) {
                    console.log('Error:', error);
                }
            });
            formAddMember.classList.add('was-validated');
        }, false);



    })();


    function toast({ title = "", message = "", type = "info", duration = 3000 }) {
        console.log(title)
        const main = document.getElementById("toastmess");
        if (main) {
            const toast = document.createElement("div");

            // Auto remove toast
            const autoRemoveId = setTimeout(function () {
                main.removeChild(toast);
            }, duration + 1000);

            // Remove toast when clicked
            toast.onclick = function (e) {
                if (e.target.closest(".toast__close")) {
                    main.removeChild(toast);
                    clearTimeout(autoRemoveId);
                }
            };

            const icons = {
                success: "fas fa-check-circle",
                info: "fas fa-info-circle",
                warning: "fas fa-exclamation-circle",
                error: "fas fa-exclamation-circle"
            };
            const icon = icons[type];
            const delay = (duration / 1000).toFixed(2);

            toast.classList.add("toastmess", `toast--${type}`);
            toast.style.animation = `slideInLeft ease .3s, fadeOut linear 1s ${delay}s forwards`;

            toast.innerHTML = `
                        <div class="toast__icon">
                            <i class="${icon}"></i>
                        </div>
                        <div class="toast__body">
                            <h3 class="toast__title">${title}</h3>
                            <p class="toast__msg">${message}</p>
                        </div>
                        <div class="toast__close">
                            <i class="fas fa-times"></i>
                        </div>
                    `;
            main.appendChild(toast);
        }
    }


    function validateEmail(email) {
        const re = /^[^\s@@]+@@[^\s@@]+\.[^\s@@]+$/;
        return re.test(String(email).toLowerCase());
    }
    flatpickr("#datetimepicker", {
        enableTime: true, // cho phép chọn giờ và phút
        dateFormat: "Y-m-d H:i", // định dạng ngày và giờ
        time_24hr: true // hiển thị định dạng 24 giờ
    });


</script>

